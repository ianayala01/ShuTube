<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <link rel="stylesheet" href="/style.css"/>
</head>
<body>
    <%- include('partials/navbar') %>

    <div class="vid">
        <h1><%= media.name %></h1>

        <video controls class="vid-player">
            <source src="/media/<%= media.filename %>" type="video/mp4" class="vid-img">
            <% if (media.subtitle) { %>
                <track label="English" kind="subtitles" srclang="en" src="/media/<%= media.subtitle %>" default>
            <% } %>
            Your browser does not support the video tag.
        </video>
        
        <label>
            <input type="checkbox" id="autoplayToggle"/>
            Autoplay Next
        </label>
        <script>
            const video = document.querySelector('video');
            const autoplayToggle = document.getElementById('autoplayToggle');
          
            // Load saved toggle preference
            autoplayToggle.checked = localStorage.getItem('autoplayNext') === 'true';
          
            autoplayToggle.addEventListener('change', () => {
              localStorage.setItem('autoplayNext', autoplayToggle.checked);
            });
          
            video.addEventListener('ended', () => {
              if (autoplayToggle.checked) {
                const nextLink = document.querySelector("a[href*='<%= nextVideo.name %>]'");
                if (nextLink) {
                  window.location.href = nextLink.href;
                }
              }
            });
          </script>
          
    </div>
</body>
</html>

<!-- 'a[href*="Next"]' -->